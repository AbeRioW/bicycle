C51 COMPILER V9.01   UI                                                                    04/06/2025 16:31:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE UI
OBJECT MODULE PLACED IN .\output\ui.obj
COMPILER INVOKED BY: D:\programFile\KEIL4\C51\BIN\C51.EXE bsp\ui.c BROWSE INCDIR(.\app;.\bsp) DEBUG OBJECTEXTEND PRINT(.
                    -\listing\ui.lst) OBJECT(.\output\ui.obj)

line level    source

   1          #include "ui.h"
   2          
   3          void show_time(void)
   4          {
   5   1                  unsigned char dat;
   6   1                  unsigned char second, minute, hour;
   7   1                      unsigned char year, month, date,week;
   8   1                       Lcd_show_string(1,1,"Current Time",12);
   9   1      
  10   1      
  11   1                      dat = DS3231_Read(0x06);
  12   1                      year = ((dat&0x70)>>4)*10+(dat&0x0f);
  13   1                      LcdWrite(0x80+0+0x40,year/10+0x30);
  14   1                      LcdWrite(0x80+1+0x40,year%10+0x30);
  15   1      
  16   1                      dat = DS3231_Read(0x05);
  17   1                      month = ((dat&0x70)>>4)*10+(dat&0x0f);
  18   1                      LcdWrite(0x80+2+0x40,month/10+0x30);
  19   1                      LcdWrite(0x80+3+0x40,month%10+0x30);
  20   1      
  21   1                       dat = DS3231_Read(0x04);
  22   1                       date =  ((dat&0x70)>>4)*10+(dat&0x0f);
  23   1                      LcdWrite(0x80+4+0x40,date/10+0x30);
  24   1                      LcdWrite(0x80+5+0x40,date%10+0x30);
  25   1      
  26   1                      //时间
  27   1                      dat = DS3231_Read(0x02);
  28   1                      hour =  ((dat&0x70)>>4)*10+(dat&0x0f);
  29   1                      LcdWrite(0x80+7+0x40,hour/10+0x30);
  30   1                      LcdWrite(0x80+8+0x40,hour%10+0x30);
  31   1                      LcdWrite(0x80+9+0x40,':');
  32   1      
  33   1      
  34   1                      dat = DS3231_Read(0x01);
  35   1                  minute = ((dat&0x70)>>4)*10+(dat&0x0f);
  36   1                      LcdWrite(0x80+10+0x40,minute/10+0x30);
  37   1                      LcdWrite(0x80+11+0x40,minute%10+0x30);
  38   1                      LcdWrite(0x80+12+0x40,':');
  39   1      
  40   1                      dat = DS3231_Read(0x00);
  41   1                      second = ((dat&0x70)>>4)*10+(dat&0x0f);
  42   1                      LcdWrite(0x80+13+0x40,second/10+0x30);
  43   1                      LcdWrite(0x80+14+0x40,second%10+0x30);
  44   1      }
*** WARNING C280 IN LINE 7 OF BSP\UI.C: 'week': unreferenced local variable
  45          
  46          
  47          void show_dht(unsigned char RH,unsigned char RL,unsigned char TH,unsigned char TL)
  48          {
  49   1                      LcdWrite(0x80+0x40,RH/10+0x30);
  50   1                      LcdWrite(0x80+0x40+1,RH%10+0x30);
  51   1                      LcdWrite(0x80+0x40+2,'.');
  52   1                      LcdWrite(0x80+0x40+3,RL/10+0x30);
  53   1                      LcdWrite(0x80+0x40+4,RL%10+0x30);
C51 COMPILER V9.01   UI                                                                    04/06/2025 16:31:13 PAGE 2   

  54   1                      LcdWrite(0x80+0x40+5,'%');
  55   1                      LcdWrite(0x80+0x40+6,'R');
  56   1                      LcdWrite(0x80+0x40+7,'H');
  57   1      
  58   1                      LcdWrite(0x80+0x40+9,TH/10+0x30);
  59   1                      LcdWrite(0x80+0x40+10,TH%10+0x30);
  60   1                      LcdWrite(0x80+0x40+11,'.');
  61   1                      LcdWrite(0x80+0x40+12,TL/10+0x30);
  62   1                      LcdWrite(0x80+0x40+13,TL%10+0x30);
  63   1                      LcdWrite(0x80+0x40+14,'C');
  64   1      }
  65          
  66          
  67          void handle_setting(void)
  68          {
  69   1              unsigned char dat_y,dat_month,dat_date,dat_hour,dat_minute,dat_second;
  70   1                  unsigned char second, minute, hour;
  71   1                      unsigned char year, month, date,week;
  72   1                      char data_chow[2]={0};
  73   1                      int position=0;
  74   1      
  75   1                 Lcd_show_string(1,1,"Setting time",12);
  76   1                      dat_y = DS3231_Read(0x06);
  77   1                      year = ((dat_y&0x70)>>4)*10+(dat_y&0x0f);
  78   1                      LcdWrite(0x80+0x40+0,year/10+0x30);
  79   1                      LcdWrite(0x80+0x40+1,year%10+0x30);
  80   1      
  81   1                      dat_month = DS3231_Read(0x05);
  82   1                      month = ((dat_month&0x70)>>4)*10+(dat_month&0x0f);
  83   1                      LcdWrite(0x80+0x40+2,month/10+0x30);
  84   1                      LcdWrite(0x80+0x40+3,month%10+0x30);
  85   1      
  86   1                       dat_date = DS3231_Read(0x04);
  87   1                       date =  ((dat_date&0x70)>>4)*10+(dat_date&0x0f);
  88   1                      LcdWrite(0x80+0x40+4,date/10+0x30);
  89   1                      LcdWrite(0x80+0x40+5,date%10+0x30);
  90   1      
  91   1                      //时间
  92   1      
  93   1                      dat_hour = DS3231_Read(0x02);
  94   1                      hour = ((dat_hour&0x70)>>4)*10+(dat_hour&0x0f);
  95   1                      LcdWrite(0x80+0x40+7,hour/10+0x30);
  96   1                      LcdWrite(0x80+0x40+8,hour%10+0x30);
  97   1                      LcdWrite(0x80+0x40+9,':');
  98   1      
  99   1      
 100   1                      dat_minute = DS3231_Read(0x01);
 101   1                  minute = ((dat_minute&0x70)>>4)*10+(dat_minute&0x0f);
 102   1                      LcdWrite(0x80+0x40+10,minute/10+0x30);
 103   1                      LcdWrite(0x80+0x40+11,minute%10+0x30);
 104   1                      LcdWrite(0x80+0x40+12,':');
 105   1      
 106   1                      dat_second = DS3231_Read(0x00);
 107   1                      second = ((dat_second&0x70)>>4)*10+(dat_second&0x0f);
 108   1                      LcdWrite(0x80+0x40+13,second/10+0x30);
 109   1                      LcdWrite(0x80+0x40+14,second%10+0x30);
 110   1              while(1)
 111   1              {
 112   2                       if(BUTTON_L ==0)                         //KEY1移动
 113   2                       {
 114   3                          delay_ms(100);
 115   3                          if(BUTTON_L ==0)
C51 COMPILER V9.01   UI                                                                    04/06/2025 16:31:13 PAGE 3   

 116   3                              {
 117   4                                      position++;
 118   4                                      if(position>5)
 119   4                                      {
 120   5                                              //把数据写到DS3221中
 121   5                                              DS3231_Write(0x06,dat_y);
 122   5                                              DS3231_Write(0x05,dat_month);
 123   5                                              DS3231_Write(0x04,dat_date);
 124   5                                              DS3231_Write(0x02,dat_hour);
 125   5                                              DS3231_Write(0x01,dat_minute);
 126   5                                              DS3231_Write(0x00,dat_second);
 127   5                                               LCDClear();
 128   5                                               return;
 129   5                                      }
 130   4                              }
 131   3      
 132   3                       }
 133   2      
 134   2                       if(BUTTON_M==0)
 135   2                       {
 136   3                              delay_ms(100);
 137   3                          if(BUTTON_M==0)
 138   3                              {
 139   4                                      switch(position)
 140   4                                              {
 141   5                                                      case 0:    //对年的设置
 142   5                                                              dat_y=dat_y-1;
 143   5                                                              if(dat_y<0)
 144   5                                                              {
 145   6                                                                      dat_y=99;       
 146   6                                                              }
 147   5                                                      year = ((dat_y&0x70)>>4)*10+(dat_y&0x0f);
 148   5                                                              LcdWrite(0x80+0x40+0,year/10+0x30);
 149   5                                                              LcdWrite(0x80+0x40+1,year%10+0x30);     
 150   5                                                      break;
 151   5                                                      case 1:   //对月的设置
 152   5                                                              dat_month=dat_month-1;
 153   5                                                              if(dat_month<1)
 154   5                                                              {
 155   6                                                                      dat_month=12;   
 156   6                                                              }
 157   5                                                      month = ((dat_month&0x70)>>4)*10+(dat_month&0x0f);
 158   5                                                              LcdWrite(0x80+0x40+2,month/10+0x30);
 159   5                                                              LcdWrite(0x80+0x40+3,month%10+0x30);    
 160   5                                                      break;
 161   5                                                      case 2:   //对日的设置
 162   5                                                              dat_date=dat_date-1;
 163   5                                                              if(dat_date<1)
 164   5                                                              {
 165   6                                                                      dat_date=31;    
 166   6                                                              }
 167   5                                                      date = ((dat_date&0x70)>>4)*10+(dat_date&0x0f);
 168   5                                                              LcdWrite(0x80+0x40+4,date/10+0x30);
 169   5                                                              LcdWrite(0x80+0x40+5,date%10+0x30);     
 170   5                                                      break;
 171   5      
 172   5                                                      case 3:   //对时的设置
 173   5                                                              dat_hour=dat_hour-1;
 174   5                                                              if(dat_hour<0)
 175   5                                                              {
 176   6                                                                      dat_hour=23;    
 177   6                                                              }
C51 COMPILER V9.01   UI                                                                    04/06/2025 16:31:13 PAGE 4   

 178   5                                                      hour = ((dat_hour&0x70)>>4)*10+(dat_hour&0x0f);
 179   5                                                              LcdWrite(0x80+0x40+7,hour/10+0x30);
 180   5                                                              LcdWrite(0x80+0x40+8,hour%10+0x30);     
 181   5                                                      break;
 182   5                                                      case 4:   //对时的设置
 183   5                                                              dat_minute=dat_minute-1;
 184   5                                                              if(dat_minute<0)
 185   5                                                              {
 186   6                                                                      dat_minute=59;  
 187   6                                                              }
 188   5                                                      minute = ((dat_minute&0x70)>>4)*10+(dat_minute&0x0f);
 189   5                                                              LcdWrite(0x80+0x40+10,minute/10+0x30);
 190   5                                                              LcdWrite(0x80+0x40+11,minute%10+0x30);  
 191   5                                                      break;
 192   5                                                      case 5:   //对秒的设置
 193   5                                                              dat_second=dat_second-1;
 194   5                                                              if(dat_second<0)
 195   5                                                              {
 196   6                                                                      dat_second=59;  
 197   6                                                              }
 198   5                                                      second = ((dat_second&0x70)>>4)*10+(dat_second&0x0f);
 199   5                                                              LcdWrite(0x80+0x40+13,second/10+0x30);
 200   5                                                              LcdWrite(0x80+0x40+14,second%10+0x30);  
 201   5                                                      break;
 202   5                                              }
 203   4      
 204   4                              }
 205   3                       }
 206   2      
 207   2                       if(BUTTON_R==0)
 208   2                       {
 209   3                              delay_ms(100);
 210   3                          if(BUTTON_R==0)
 211   3                              {
 212   4                                  switch(position)
 213   4                                      {
 214   5                                               case 0:        //对年的设置
 215   5                                                      dat_y=dat_y+1;
 216   5                                                      if(dat_y>99)
 217   5                                                      {
 218   6                                                              dat_y=0;        
 219   6                                                      }
 220   5                                              year = ((dat_y&0x70)>>4)*10+(dat_y&0x0f);
 221   5                                                      LcdWrite(0x80+0x40+0,year/10+0x30);
 222   5                                                      LcdWrite(0x80+0x40+1,year%10+0x30);     
 223   5                                               break;
 224   5                                               case 1:          //对月的设置
 225   5                                                              dat_month=dat_month+1;
 226   5                                                              if(dat_month>12)
 227   5                                                              {
 228   6                                                                      dat_month=1;    
 229   6                                                              }
 230   5                                                      month = ((dat_month&0x70)>>4)*10+(dat_month&0x0f);
 231   5                                                              LcdWrite(0x80+0x40+2,month/10+0x30);
 232   5                                                              LcdWrite(0x80+0x40+3,month%10+0x30);    
 233   5                                                      break;
 234   5                                                      case 2:   //对日的设置
 235   5                                                              dat_date=dat_date+1;
 236   5                                                              if(dat_date>31)
 237   5                                                              {
 238   6                                                                      dat_date=1;     
 239   6                                                              }
C51 COMPILER V9.01   UI                                                                    04/06/2025 16:31:13 PAGE 5   

 240   5                                                      date = ((dat_date&0x70)>>4)*10+(dat_date&0x0f);
 241   5                                                              LcdWrite(0x80+0x40+4,date/10+0x30);
 242   5                                                              LcdWrite(0x80+0x40+5,date%10+0x30);     
 243   5                                                      break;
 244   5                                                      case 3:   //对时的设置
 245   5                                                              dat_hour=dat_hour+1;
 246   5                                                              if(dat_hour>23)
 247   5                                                              {
 248   6                                                                      dat_hour=0;     
 249   6                                                              }
 250   5                                                      date = ((dat_hour&0x70)>>4)*10+(dat_hour&0x0f);
 251   5                                                              LcdWrite(0x80+0x40+7,date/10+0x30);
 252   5                                                              LcdWrite(0x80+0x40+8,date%10+0x30);     
 253   5                                                      break;
 254   5      
 255   5                                                      case 4:   //对分的设置
 256   5                                                              dat_minute=dat_minute+1;
 257   5                                                              if(dat_minute>59)
 258   5                                                              {
 259   6                                                                      dat_minute=0;   
 260   6                                                              }
 261   5                                                      minute = ((dat_minute&0x70)>>4)*10+(dat_minute&0x0f);
 262   5                                                              LcdWrite(0x80+0x40+10,minute/10+0x30);
 263   5                                                              LcdWrite(0x80+0x40+11,minute%10+0x30);  
 264   5                                                      break;
 265   5                                                      case 5:   //对秒的设置
 266   5                                                              dat_second=dat_second+1;
 267   5                                                              if(dat_second>59)
 268   5                                                              {
 269   6                                                                      dat_second=0;   
 270   6                                                              }
 271   5                                                      second = ((dat_second&0x70)>>4)*10+(dat_second&0x0f);
 272   5                                                              LcdWrite(0x80+0x40+13,second/10+0x30);
 273   5                                                              LcdWrite(0x80+0x40+14,second%10+0x30);  
 274   5                                                      break;
 275   5                                      }
 276   4      
 277   4                              }
 278   3                       }
 279   2              }
 280   1      }
*** WARNING C280 IN LINE 71 OF BSP\UI.C: 'week': unreferenced local variable
 281          
 282          void ui_setting(void)
 283          {
 284   1          int position=0;
 285   1              Lcd_show_string(1,1,"Setting Menu",12);
 286   1              Lcd_show_string(2,0,"L:Opt R:Sure",12);
 287   1              delay_ms(1000);
 288   1              while(1)
 289   1              {
 290   2                      if(BUTTON_R==0)
 291   2                      {
 292   3                              LCDClear();
 293   3                              return;
 294   3                      }
 295   2                      
 296   2                      if(BUTTON_L==0)
 297   2                      {
 298   3                              LCDClear();
 299   3                              handle_setting();
 300   3                              return;
C51 COMPILER V9.01   UI                                                                    04/06/2025 16:31:13 PAGE 6   

 301   3                      }  
 302   2              }       
 303   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1820    ----
   CONSTANT SIZE    =     54    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      30
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
